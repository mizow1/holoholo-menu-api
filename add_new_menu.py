import pandas as pd
from openpyxl import load_workbook
import sys
from datetime import datetime

sys.stdout.reconfigure(encoding='utf-8')

# 新メニューの定義
NEW_MENU_ID = 1068
MENU_NAME = 'あの人との恋の未来◆二人の関係の行方と展開'
MENU_NAME_SHORT = 'あの人との恋の未来'
CAPTION = 'あの人への想い、相手の気持ち、これからの展開…気になる恋の行方をタロットカードが鑑定します。'
CATEGORY = 1  # 恋愛カテゴリー
START_DATE = '2025-11-10'

# 小項目（3つ）
ITEMS = [
    'あの人の今のあなたへの気持ちは？',
    '二人の関係はこれからどう変化する？',
    '恋を実らせるためにあなたがすべきこと'
]

# 各項目に使用するカード番号（4枚ずつ）
CARD_NUMBERS = [1, 5, 9, 13]

# カード別の結果テキスト（ハワイアンタロット風）
RESULTS = {
    1: {
        1: 'あの人を表しているのは【マナ】のカード。マナは生命エネルギーや霊的な力を意味します。今、あの人はあなたに対して特別な興味を抱いています。あなたといると不思議と元気が湧いてくる、そんな感覚を持っているのです。まだ恋愛感情とまではっきり自覚していないかもしれませんが、あなたの存在が心の栄養になっていることは間違いありません。会話をするたびに笑顔が増え、連絡を取り合うことに喜びを感じています。この「一緒にいると心地よい」という感覚が、やがて恋心へと育っていく可能性を秘めています。',
        2: '【アロハ】のカードが出ました。アロハは愛と調和を象徴します。二人の関係は、今後ゆっくりと、しかし確実に深まっていくでしょう。急激な変化ではなく、穏やかな波のように少しずつ距離が縮まっていきます。共通の趣味や話題を通じて、お互いの理解が深まる時期が訪れます。友人から始まり、やがて特別な存在へと変化していく流れが見えています。焦らず、自然な流れに身を任せることで、理想的な関係性が築かれていくでしょう。',
        3: '【オハナ】のカードです。オハナは家族や絆を意味します。恋を実らせるためには、まず自分自身を大切にすることが重要です。自分の魅力に自信を持ち、ありのままの姿で接することで、相手もあなたの真実の姿に惹かれていきます。また、共通の友人との交流を大切にすることも吉。グループでの集まりや、複数人での会話の中で、あなたの人柄の良さが自然と伝わり、相手の心に響いていくでしょう。'
    },
    5: {
        1: '【ホオポノポノ】のカードが表れました。ホオポノポノは許しと浄化を意味します。あの人は今、過去の恋愛での傷を癒している最中かもしれません。あなたに対しては好意的ですが、新しい関係を始めることに少し慎重になっています。しかし、あなたの優しさや思いやりが、徐々にその心の壁を溶かしていくでしょう。焦らず、じっくりと信頼関係を築いていくことが大切です。',
        2: '【カイ】のカードです。カイは海を意味し、広大さと可能性を象徴します。二人の関係には、まだ見ぬ可能性が広がっています。これから訪れる新しい出来事や環境の変化が、二人を一気に近づけるきっかけになるでしょう。旅行やイベント、あるいは共同プロジェクトなど、一緒に何かを体験する機会が訪れます。その経験を通じて、お互いの新しい一面を発見し、関係性が一段階深まっていきます。',
        3: '【ラニ】のカードが出ました。ラニは天空や高みを意味します。恋を実らせるには、自分自身の魅力を高める努力が必要です。外見だけでなく、内面の成長や新しいスキルの習得など、自己投資に時間を使いましょう。あなたが輝いている姿を見せることで、相手の目にあなたの価値がより明確に映ります。また、ポジティブな言葉遣いと明るい笑顔を心がけることで、相手の心を引き寄せることができるでしょう。'
    },
    9: {
        1: '【ウルア】のカードです。ウルアは魚を意味し、豊かさと流れを象徴します。あの人はあなたに対して、安心感と信頼感を抱いています。あなたといると心が落ち着き、自然体でいられると感じているのです。恋愛感情としてははっきりしていないかもしれませんが、「大切な人」として認識されています。この信頼関係が、やがて恋心へと発展する土台となっていくでしょう。',
        2: '【アヌエヌエ】のカードが現れました。アヌエヌエは虹を意味し、希望と幸運の象徴です。二人の関係は、これから劇的に好転していきます。今まで停滞していた状況が動き出し、予想以上のスピードで距離が縮まる可能性があります。偶然の再会や思いがけない出来事が、二人を結びつける運命の糸を強くしていくでしょう。近い将来、関係性が大きく前進する嬉しいサプライズが待っています。',
        3: '【ホク】のカードです。ホクは星を意味し、導きと希望を象徴します。恋を実らせるためには、自分の気持ちを素直に表現することが大切です。ただし、重くならないように、軽やかで自然な形で好意を伝えましょう。小さな気遣いや優しい言葉、さりげないプレゼントなど、日常の中でできる愛情表現を積み重ねていくことで、相手の心に確実に届いていきます。'
    },
    13: {
        1: '【マヒナ】のカードが出ました。マヒナは月を意味し、感情と神秘を象徴します。あの人は、あなたに対して複雑な感情を抱いています。惹かれている気持ちはあるものの、それを認めることに躊躇している様子が見えます。周囲の目や、自分の立場、あるいは過去の経験などが、その気持ちにブレーキをかけているのかもしれません。しかし、その迷いもまた、あなたを大切に思っているからこそ。時間をかけて、じっくりと関係を育てていくことで、やがてその想いが明確な形になっていくでしょう。',
        2: '【マカニ】のカードです。マカニは風を意味し、変化と自由を象徴します。二人の関係には、予測できない変化が訪れる可能性があります。環境の変化や新しい出会いなど、外的要因が二人の距離感に影響を与えるかもしれません。しかし、その変化を恐れる必要はありません。変化こそが、停滞していた関係を動かす原動力となり、新しいステージへと進むきっかけになります。柔軟な心で変化を受け入れ、流れに乗ることで、望む未来へと近づいていけるでしょう。',
        3: '【ナル】のカードが現れました。ナルは波を意味し、リズムと繰り返しを象徴します。恋を実らせるためには、コンスタントなコミュニケーションが鍵となります。一度きりの大きなアプローチよりも、継続的な小さな接触の方が効果的です。定期的な連絡、挨拶、日常的な会話を大切にしましょう。また、相手の話をよく聞き、共感を示すことで、あなたへの信頼と好意が波のように高まっていきます。'
    }
}

print('新メニュー追加処理を開始します...\n')

# Excelファイルを読み込む
file_path = 'ホロホロタロット追加メニュー.xlsx'
wb = load_workbook(file_path)

# 1. メニューシートに追加
print('【1/3】メニューシートに追加中...')
ws_menu = wb['メニュー']
# 最終行を探す
last_row = ws_menu.max_row
while last_row > 0 and ws_menu.cell(last_row, 1).value is None:
    last_row -= 1
new_row = last_row + 1

# メニューデータを追加
ws_menu.cell(new_row, 1, NEW_MENU_ID)  # メニューID
ws_menu.cell(new_row, 2, MENU_NAME)  # メニュー名
ws_menu.cell(new_row, 3, MENU_NAME_SHORT)  # メニュー名（短）
ws_menu.cell(new_row, 4, CAPTION)  # キャプション
ws_menu.cell(new_row, 8, CATEGORY)  # 中カテゴリー
ws_menu.cell(new_row, 9, START_DATE)  # 公開日

print(f'  メニューID {NEW_MENU_ID}: {MENU_NAME_SHORT} を追加しました')

# 2. 小項目シートに追加
print('\n【2/3】小項目シートに追加中...')
ws_item = wb['小項目']
last_row = ws_item.max_row
while last_row > 0 and ws_item.cell(last_row, 1).value is None:
    last_row -= 1

for idx, item_name in enumerate(ITEMS, start=1):
    new_row = last_row + idx
    menu_id_str = str(int(NEW_MENU_ID))
    item_id_str = f"{menu_id_str}{idx:02d}"

    ws_item.cell(new_row, 1, NEW_MENU_ID)  # メニューID
    ws_item.cell(new_row, 2, idx)  # 項目ID
    ws_item.cell(new_row, 3, item_name)  # 項目名
    print(f'  項目{idx}: {item_name}')

# 3. 結果シートに追加
print('\n【3/3】結果シートに追加中...')
ws_result = wb['結果']
last_row = ws_result.max_row
while last_row > 0 and ws_result.cell(last_row, 1).value is None:
    last_row -= 1

result_count = 0
for item_idx in range(1, 4):  # 3つの小項目
    for card_idx, card_num in enumerate(CARD_NUMBERS, start=1):
        new_row = last_row + result_count + 1
        menu_id_str = str(int(NEW_MENU_ID))
        result_id_str = f"{menu_id_str}{item_idx:02d}{card_idx:02d}"

        ws_result.cell(new_row, 1, NEW_MENU_ID)  # メニューID
        ws_result.cell(new_row, 2, item_idx)  # 項目ID
        ws_result.cell(new_row, 3, card_idx)  # 結果ID
        ws_result.cell(new_row, 4, card_num)  # カード番号
        ws_result.cell(new_row, 5, RESULTS[card_num][item_idx])  # 結果本文

        result_count += 1

print(f'  {result_count}件の占い結果を追加しました')

# 保存
print('\n保存中...')
wb.save(file_path)
print(f'✓ {file_path} への追加が完了しました！')

print('\n=== 追加内容サマリー ===')
print(f'メニューID: {NEW_MENU_ID}')
print(f'メニュー名: {MENU_NAME}')
print(f'小項目数: {len(ITEMS)}')
print(f'占い結果数: {result_count}')
print('=' * 50)
