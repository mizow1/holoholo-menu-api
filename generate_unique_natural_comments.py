import pandas as pd
import sys
import random
from datetime import datetime, timedelta

sys.stdout.reconfigure(encoding='utf-8')

# Excelファイル読み込み
df = pd.read_excel('ホロホロタロット追加メニュー.xlsx')
df_contents = df[df['contents_id'].notna()].copy()
df_contents = df_contents[['contents_id', 'name', 'caption', 'category']].copy()
df_contents = df_contents.drop_duplicates(subset=['contents_id'])
df_contents = df_contents[df_contents['contents_id'].apply(lambda x: isinstance(x, (int, float)) and x > 0)]

# 100件のメニューだけを取得
df_contents = df_contents.head(100)

# 完全にユニークな100件のコメントを手動で作成（具体的で自然な表現）
unique_comments = [
    # 1-10: 結婚・恋愛系
    '将来の伴侶がどんな性格なのか分かって、楽しみになってきました。',
    '職場の人たちが私のことをどう見てるのか、ずっと気になってたんです。',
    '周りの評価が気になってたので、すごく参考になりました。',
    '生まれてきた意味とか考えたこともなかったけど、深いですね。',
    '別れたあの人の言葉、ずっと気になってて。信じていいって分かって安心しました。',
    '来年の今頃どうなってるか知れて良かった。希望が持てます。',
    'なんで出会ったんだろうってずっと不思議だったけど、意味があったんですね。',
    '天職って何だろうって悩んでたので、ヒントをもらえました。',
    '彼の気持ち、ずっとモヤモヤしてたけど少し分かった気がします。',
    '今の彼と復縁できる可能性、まだあるって知れて嬉しかったです。',

    # 11-20: 恋愛・片思い系
    '二人が出会ったきっかけ、偶然じゃなかったんだ。',
    '運命って本当にあるのかもって思えてきました。',
    '元彼への未練、ずっと断ち切れなくて。でも前向きになれそうです。',
    '今の彼、本当に私のこと好きなのかな...って不安だったけど安心しました。',
    '友達に相談できないことだったので、占ってもらって良かった。',
    '同僚からの評価、思ってたより良くて安心しました。',
    '好きな人との相性、気になってたんです。',
    'この恋、進展するのか諦めるべきか悩んでたけど答えが出ました。',
    '人生って何のために生きてるんだろうって最近よく考えてたので。',
    '悩んでたこと、スッと腑に落ちた感じがします。',

    # 21-30: 仕事・キャリア系
    'こんな仕事向いてるなんて思ってもみなかったです。',
    '未来の自分、想像つかなかったけど少し見えてきた気がします。',
    '結婚したいけど相手がどんな人か全然分からなくて。イメージできました。',
    '復縁について占うの初めてだったけど、勇気が出ました。',
    '婚期がいつ頃か知りたくて占ってもらいました。参考になります。',
    '好きな人の本心、ずっと知りたかったんです。',
    '彼の態度、最近よそよそしくて...理由が分かって良かった。',
    'あの人、私のこと友達としか思ってないのかなって不安でした。',
    '気になる人がいるんだけど、アプローチしていいのか迷ってて。',
    '人生の転機が近いって言われて、ドキドキしてます。',

    # 31-40: 人間関係・人生系
    '今の仕事、このまま続けていいのか不安だったんです。',
    '将来のパートナーの顔立ちまで分かるなんて、すごい。',
    '別れた彼のこと、まだ好きなのか自分でも分からなくて。',
    '運命の赤い糸って本当にあるんですかね。信じてみたくなりました。',
    '1年後の未来、どうなってるか楽しみです。',
    '二人の出会い、必然だったって思えて嬉しい。',
    '自分に向いてる職業、今まで考えたこともなかったです。',
    '復縁の可能性、ゼロじゃないって分かっただけで希望が持てました。',
    '結婚相手の性格、理想通りの人だといいな。',
    '彼の本音、やっぱりそうだったんだ...。',

    # 41-50: 恋愛・相性系
    '友達からの評価と恋人候補としての評価、違うんですね。',
    '告白するタイミング、今じゃないって分かって良かったかも。',
    '生きてる意味とか、哲学的なこと考えるようになりました。',
    '占ってもらうまで気づかなかったこと、たくさんありました。',
    '自分の適職、意外な結果でびっくりしました。',
    'あの人との未来、明るいものが待ってるといいな。',
    '結婚願望はあるけど相手が見つからなくて...。励まされました。',
    '元カレ、今何してるんだろうって時々思い出すんです。',
    '復縁したい気持ち、自分でも整理つかなくて。',
    '運命の人って、どこかにいるんでしょうか。',

    # 51-60: 仕事・評価系
    '好きな人の気持ち、ストレートに聞けないから占ってもらいました。',
    '彼氏の態度が冷たくなってきて、不安で仕方なかったんです。',
    '片思いって辛いけど、この恋には意味があるって思えました。',
    '人生の目的、20代のうちに見つけられて良かったです。',
    '周りの人が私をどう思ってるか、気になってました。',
    '天職に就けてるかどうか、ずっと疑問だったので。',
    '来年どうなってるか不安だったけど、ポジティブに考えられそう。',
    '偶然の出会いだと思ってたけど、運命だったのかも。',
    '仕事選び、間違ってなかったって確認できました。',
    '元彼との復縁、諦めきれなくて...。',

    # 61-70: 恋愛・結婚系
    '結婚運、今まで気にしたことなかったけど大事ですね。',
    '彼の本心、やっと理解できた気がします。',
    '友達としか見られてないと思ってたから、嬉しかったです。',
    'アプローチの仕方、これで間違ってないって分かって安心。',
    '自分らしく生きるって、こういうことなんですね。',
    '将来のこと、漠然と不安だったけど少し晴れました。',
    '適職診断、学生の時にやっておけば良かったです。',
    '復縁の可能性、まだ残ってるなら頑張ってみようかな。',
    '理想の結婚相手、具体的にイメージできるようになりました。',
    '彼の気持ち、確かめる勇気が出なくて占ってもらいました。',

    # 71-80: 人生・未来系
    '職場での立ち位置、これで良かったんだって思えました。',
    '恋愛か友情か、自分の気持ちもよく分からなくて。',
    '人生の岐路に立ってる気がして、占ってもらいました。',
    'モヤモヤしてた悩み、整理できた感じがします。',
    '向いてる仕事、全然違うジャンルでびっくり。',
    '一年後の自分、想像するとワクワクしてきました。',
    '運命的な出会い、大切にしたいと思います。',
    '転職するべきか悩んでたので、背中を押してもらえました。',
    '復縁、もう無理かなって諦めかけてたんですが...。',
    '結婚相手の条件、見直すきっかけになりました。',

    # 81-90: 恋愛・気持ち系
    '好きな人の気持ち、知るのが怖かったけど知れて良かった。',
    '彼との関係、このままでいいのか不安でした。',
    '片思い中の彼、脈ありなのか知りたくて。',
    '生まれた意味、考えさせられました。深いです。',
    '周囲の評価、思ってたのと違って驚きました。',
    '天職探し、ずっと迷走してたけど方向性が見えた。',
    '未来の自分、幸せになってるといいな。',
    '二人の縁、大切にしていきたいです。',
    '仕事運、これから上がっていくって信じます。',
    '元彼への気持ち、やっと整理できそうです。',

    # 91-100: 総合系
    '結婚したい気持ちはあるけど、相手が...って感じでした。',
    '彼の本音、やっぱりそうだったんですね。',
    '恋愛対象として見てもらえてるか、ずっと気になってました。',
    '人として成長できてるのか、不安だったので。',
    '周りにどう映ってるか、客観的に知れて良かった。',
    'この仕事で幸せになれるか、確信が持てました。',
    '1年後、どんな自分になってるか楽しみです。',
    '出会いの意味、大切にしたいと思いました。',
    '適職、見つけられそうな気がしてきました。',
    '復縁への道、まだ残ってるって分かって嬉しいです。',
]

# 日付生成
def random_date():
    start_date = datetime(2023, 10, 1)
    end_date = datetime(2023, 12, 31)
    delta = end_date - start_date
    random_days = random.randint(0, delta.days)
    return (start_date + timedelta(days=random_days)).strftime('%Y-%m-%d 00:00:00')

# SQLファイルの生成
output_lines = []
output_lines.append("INSERT INTO flowt_seimei.mana_comment (contents_id,title,comment,score,approval,`date`) VALUES")

records = []
for idx, row in df_contents.iterrows():
    contents_id = int(row['contents_id'])
    comment = unique_comments[len(records)]  # 順番に使用（100件すべてユニーク）
    score = random.randint(3, 5)
    date = random_date()
    records.append(f"\t ({contents_id},NULL,'{comment}',{score},1,'{date}')")

# 10件ごとにINSERT文を分割
chunk_size = 10
for i in range(0, len(records), chunk_size):
    chunk = records[i:i+chunk_size]
    if i > 0:
        output_lines.append("INSERT INTO flowt_seimei.mana_comment (contents_id,title,comment,score,approval,`date`) VALUES")
    for j, record in enumerate(chunk):
        if j < len(chunk) - 1:
            output_lines.append(record[:-1] + ',')
        else:
            output_lines.append(record + ';')

# ファイル保存
timestamp = datetime.now().strftime('%Y%m%d%H%M')
filename = f'mana_comment_{timestamp}.sql'
with open(filename, 'w', encoding='utf-8') as f:
    f.write('\n'.join(output_lines))

print(f'生成完了: {filename}')
print(f'メニュー数: {len(df_contents)}')
print(f'コメント数: {len(records)}')
print(f'ユニークコメント数: {len(set(unique_comments[:len(records)]))}')
print(f'重複: 0件（100件すべて完全ユニーク）')
print(f'\n最初の5件のメニューとコメント:')
for i in range(5):
    row = df_contents.iloc[i]
    print(f"\nID {int(row['contents_id'])}: {str(row['name'])[:50]}...")
    comment_match = records[i].split("'")[1]
    print(f"  コメント: {comment_match}")
